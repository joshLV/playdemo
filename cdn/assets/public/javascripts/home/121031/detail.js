jQuery(function(j){var m=j("#goodsId").val();j("#link_add_cart").click(function(w){w.preventDefault();var v=j("#number").val();var u=Number(j("#boughtNumber").val());var s=Number(j("#addCartNumber").val())+v*1;var t=Number(j("#limit_"+m).val());if(t>0&&t-u>0&&s>(t-u)){j(".error").html("<strong style='display: block;'>已经超过限购数量，不能继续加入购物车！</strong>").css("color","#F55");return false}if(t>0&&v>(t-u)){v.val(t-u);return false}j.post("/carts",{goodsId:m,increment:j("#number").val()},function(x){j("#addCartNumber").val(s);j("#add_cart_result").show();setTimeout("$('#add_cart_result').css('display','none')",5000);j("#result-count").text(x.count);j("#result-amount").text(x.amount);j("#cart-count").html(x.count);j("#reload").val("true");j("#cart-js").html(x.count);j("#order_confirm").hide()})});j("#link_buy_now").click(function(){var s="${goods.limitNumber}";var t=Number(j("#number").val());if(s>0&&t>s){j(".error").html("<strong>只能购买"+s+"个</strong>").css("color","#F55");return false}j("#order_create_form").submit();return false});j("#J_closeTips").click(function(s){s.preventDefault();j("#add_cart_result").hide()});j("#increase-btn").click(function(){c(j(this).attr("name"),1);return false});j("#decrease-btn").click(function(){c(j(this).attr("name"),-1);return false});function c(w,y){var u=j("#number");var A=j("#last_num_"+w);var x=Number(j("#stock_"+w).val());var v=Number(j("#limit_"+w).val());var s=Number(A.val());var z=s+y;var t=Number(j("#boughtNumber").val());if(z<=0){u.val(s);return}if(z>999){z=999;y=999-s}if(z>x){z=x;y=x-s;j("#stock_hit").css("display","inline-block");return}else{j("#stock_hit").css("display","none")}if(v>0&&z>(v-t)){u.val(v-t);y=v-s;return false}if(y==0){u.val(s);return}u.val(z);A.val(z)}j("#gallery").slides({play:5000,pause:2500,slideSpeed:500,hoverPause:true}).hover(function(){j("#gallery .btn").show()},function(){j("#gallery .btn").hide()});j("#switch").slides({play:4000,pause:2000,slideSpeed:300,hoverPause:true});j("#qq").click(function(s){s.preventDefault();j("#share-im").slideToggle(100)});j("#share-url").click(function(){j(this).select()});var h,q,l={latlngStr:"",latlng:{},title:""},p=1,o=5,k,b,e=j("#outlet-page");if(location.host=="127.0.0.1"||location.host=="192.168.18.242"){b="/yome/home/template/outletList.php";consultUrl="/yome/home/template/consult.php"}else{b="/goods/"+m+"/shops";consultUrl="/goods/"+m+"/questions"}function g(){j.getJSON(b,"currPage="+p+"&pageSize="+o,function(s){if(s.status==0){r(s.outletList);k=Math.ceil(s.totalOutlet/5);j("#outlet-total-num").text(s.totalOutlet)}else{j("#outlet").hide()}if(k>1){e.html('<a class="next-page" href="#">下一页</a>')}})}g();function n(y,u,x,w){var t={zoom:u,center:x,zoomControl:true,panControl:false,scaleControl:false,overviewMapControl:false,streetViewControl:false,mapTypeControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP},v=new google.maps.Map(document.getElementById(y),t),s=new google.maps.Marker({position:x,map:v,animation:google.maps.Animation.DROP,title:w});return{map:v,marker:s}}j(".outlet-name").live("click",function(){j(".outlet-name").removeClass("outlet-show");j(this).addClass("outlet-show");j(".outlet-attr:visible").slideUp(100);j(this).siblings().slideToggle(100);var t=j(this).attr("data-latlng"),s=t.split(",");l.latlngStr=t;l.latlng=new google.maps.LatLng(s[0],s[1]);l.title=j(this).text();h.map.setCenter(l.latlng);h.marker.setMap(null);h.marker=new google.maps.Marker({position:l.latlng,map:h.map,animation:google.maps.Animation.DROP,title:l.title})});j(".view-map").live("click",function(s){s.preventDefault();if(j("#map_mask").length==0){j("body").append('<div id="map_mask"></div>');j("#map_mask").css({width:j(window).width(),height:j("body").height()})}else{j("#map_mask").show()}if(j("#map_box").length==0){j("body").append('<div id="map_box"><a class="close" href="javascript:void(0)" hidefocus="true"></a><h3>'+l.title+'</h3><div id="big_gmap" style="width:800px;height:500px;"></div><p>提醒：地图标注位置仅供参考，具体情况以实际道路标识信息为准</p></div>');j("#map_box .close").click(function(){j("#map_box").hide();j("#map_mask").hide()})}else{j("#map_box").show();j("#map_box h3").text(l.title)}j("#map_box").css({top:j(window).height()/2-284+j(document).scrollTop()+"px",left:j(window).width()/2-413+"px"});if(q==undefined){q=n("big_gmap",15,l.latlng,l.title)}q.map.setCenter(l.latlng);q.marker.setMap(null);q.marker=new google.maps.Marker({position:l.latlng,map:q.map,animation:google.maps.Animation.DROP,title:l.title})});j(".search-path").live("click",function(s){s.preventDefault();if(j("#map_mask").length==0){j("body").append('<div id="map_mask"></div>');j("#map_mask").css({width:j(window).width(),height:j("body").height()})}else{j("#map_mask").show()}if(j("#map_search").length==0){j("body").append('<div id="map_search"><a class="close" href="javascript:void(0)" hidefocus="true"></a><h3>查询路线</h3><form action="http://ditu.google.cn/maps" method="get" target="_blank"><ul><li><span class="text">目的地</span> <span id="daddr-txt">'+l.title+'</span><input type="hidden" id="daddr-val" name="daddr" value="'+l.latlngStr+'"></li><li><span class="text">出行方式</span> <input type="radio" name="dirflg" checked value="r">公交 <input type="radio" name="dirflg" value="d">驾车</li><li><span class="text">出发地</span> <input type="text" name="saddr" class="saddr"></li><li><button type="submit" class="btn">查询</button></li></ul></form></div>');j("#map_search .close").click(function(){j("#map_mask").hide();j("#map_search").hide()})}else{j("#map_search").show();j("#daddr-txt").text(l.title);j("#daddr-val").val(l.latlngStr)}j("#map_search").css({top:j(window).height()/2-100+j(document).scrollTop()+"px",left:j(window).width()/2-183+"px"})});function r(u){var t="";for(i in u){t+='<li><h5 class="outlet-name" data-latlng="'+u[i].latlng+'">'+u[i].name+'</h5><div class="outlet-attr">    <p>'+u[i].addr+"</p>    <p><span>"+u[i].tel+'</span> <a class="view-map" href="#">查看地图»</a> <a class="search-path" href="#">公交/驾车»</a></p></div></li>'}j(".outlet-list ul").html(t);j(".outlet-attr:first").show();j(".outlet-name:first").addClass("outlet-show");var v=u[0]["latlng"],s=v.split(",");l.latlngStr=v;l.latlng=new google.maps.LatLng(s[0],s[1]);l.title=u[0]["name"];if(h===undefined){h=n("min_gmap",13,l.latlng,l.title)}h.map.setCenter(l.latlng);h.marker.setMap(null);h.marker=new google.maps.Marker({position:l.latlng,map:h.map,animation:google.maps.Animation.DROP,title:l.title})}j("#outlet-page").delegate("a","click",function(s){s.preventDefault();if(j(this).hasClass("next-page")){p++;j.getJSON(b,"currPage="+p+"&pageSize="+o,function(t){r(t.outletList);if(k<=2){e.html('<a class="prev-page" href="#">上一页</a>')}else{if(p==k){e.html('<a class="prev-page" href="#">上一页</a>')}else{e.html('<a class="prev-page" href="#">上一页</a> | <a class="next-page" href="#">下一页</a>')}}})}if(j(this).hasClass("prev-page")){p--;j.getJSON(b,"currPage="+p+"&pageSize="+o,function(t){r(t.outletList);if(p==1){e.html('<a class="next-page" href="#">下一页</a>')}else{e.html('<a class="prev-page" href="#">上一页</a> | <a class="next-page" href="#">下一页</a>')}})}});var a={currPage:1,pageSize:5};function d(v,u){var t="";if(v>1){t+='<a class="prev" href="javascript:void(0)" data-page="'+(v-1)+'"><i></i>上一页</a>'}else{t+='<span class="prev"><i></i>上一页</span>'}if(u<=10){for(var s=1;s<=u;s++){if(v==s){t+='<span class="curr">'+s+"</span>"}else{t+='<a href="javascript:void(0)" data-page="'+s+'">'+s+"</a>"}}}else{if(v<4){for(var s=1;s<v;s++){t+='<a href="javascript:void(0)" data-page="'+s+'">'+s+"</a>"}t+='<span class="curr">'+v+"</span>";t+='<a href="javascript:void(0)" data-page="'+(Number(v)+1)+'">'+(Number(v)+1)+"</a>";t+='<a href="javascript:void(0)" data-page="'+(Number(v)+2)+'">'+(Number(v)+2)+"</a>";t+='<span class="omit">...</span>';t+='<a href="javascript:void(0)" data-page="'+u+'">'+u+"</a>"}if(v>=4&&(v<=u-3)){t+='<a href="javascript:void(0)" data-page="1">1</a>';t+='<span class="omit">...</span>';t+='<a href="javascript:void(0)" data-page="'+(Number(v)-2)+'">'+(Number(v)-2)+"</a>";t+='<a href="javascript:void(0)" data-page="'+(Number(v)-1)+'">'+(Number(v)-1)+"</a>";t+='<span class="curr">'+v+"</span>";t+='<a href="javascript:void(0)" data-page="'+(Number(v)+1)+'">'+(Number(v)+1)+"</a>";t+='<a href="javascript:void(0)" data-page="'+(Number(v)+2)+'">'+(Number(v)+2)+"</a>";t+='<span class="omit">...</span>';t+='<a href="javascript:void(0)" data-page="'+u+'">'+u+"</a>"}if(v>u-3){t+='<a href="javascript:void(0)" data-page="1">1</a>';t+='<span class="omit">...</span>';t+='<a href="javascript:void(0)" data-page="'+(Number(v)-2)+'">'+(Number(v)-2)+"</a>";t+='<a href="javascript:void(0)" data-page="'+(Number(v)-1)+'">'+(Number(v)-1)+"</a>";t+='<span class="curr">'+v+"</span>";for(var s=v+1;s<=u;s++){t+='<a href="javascript:void(0)" data-page="'+s+'">'+s+"</a>"}}}if(v<u){t+='<a class="next" href="javascript:void(0)" data-page="'+(Number(v)+1)+'"><i></i>下一页</a>'}else{t+='<span class="next"><i></i>下一页</span>'}return t}function f(){j.getJSON(consultUrl,"currPage="+a.currPage+"&pageSize="+a.pageSize,function(u){var t=u.list,s="";a.pageCount=Math.ceil(u.total/a.pageSize);if(t.length>0){for(i in t){s+='<li><dl class="question"><dt>咨询内容：</dt><dd>'+t[i].question+'<span class="date">'+t[i].qdate+'</span></dd></dl><dl class="answer"><dt>客服回复：</dt><dd>'+t[i].answer+'<span class="date">'+t[i].adate+"</span></dd></dl></li>"}j(".consult-list").html(s);j("#consult .pagination").html(d(a.currPage,a.pageCount))}})}j("#consult .pagination").delegate("a","click",function(s){s.preventDefault();a.currPage=j(this).attr("data-page");f()});f();j("#submit").click(function(x){x.preventDefault();var u=j("#question").val(),s=j("#mobile"),w=s.length==1?s.val():"",t=j("#consult-form .error"),y,v=function(z){t.html(z).show();clearTimeout(y);y=setTimeout(function(){t.hide()},3000)};if(u==""){v("请输入咨询的问题");return}if(w!=""&&!(/^(1\d{10})$/i).test(w)){v("请输入正确的手机号");return}j.get("/user-question",{content:u,mobile:w,goodsId:m},function(z){if(z.error==""){v("您的咨询发表成功，请耐心等待回复，谢谢")}else{v(z.error)}})})});