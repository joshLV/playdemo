#{extends 'main.html' /}
#{set title:'100券 - 58上传' /}
#{set 'moreStyles'}
    #{asset.css src:['/r/base.css', '/r/goods.css', '/r/play-pagination.css'] /}
<style type="text/css">
    b {
        color: red
    }

    p {
        margin-top: 15px
    }

    h1 {
        margin-top: 20px
    }
</style>
#{/set}
#{set 'moreScripts'}
<script src="@@{'/public/javascripts/city.js'}"></script>
<script src="@@{'/public/javascripts/areas.js'}"></script>
<script src="@@{'/public/javascripts/category.js'}"></script>
<script src="@{'/public/javascripts/My97DatePicker/WdatePicker.js'}" type="text/javascript" charset="UTF-8"></script>
#{/set}

#{set 'navMenu'}
<li><a href="/">首　页</a></li>
<li><a class="current" href="/goods">商品库</a></li>
<li><a href="/library">我的分销库</a></li>
<li><a href="/charge">账户充值</a></li>
<li><a href="/withdraw">账户提现</a></li>
#{/set}

#{if isEdit=='edit'}
<form action="/58-edit" method="POST">
#{/if}
#{else}
<form action="/58-add" method="POST">
#{/else}
<div id="content">
<h1 style="font-size:200%">商品信息</h1>

<p>商品分类<b>*</b></p>
#{select 'prodTypeId', id:'category',value:prodTypeId}#{/select}
<p>
    产品范畴<b>*</b>
    <input type="radio" name="prodCategory" value="0" checked> 消费类
    <input type="radio" name="prodCategory" value="1"> 快递类
</p>

<p>发布产品的名称<b>* 最多200字</b></p>
<input type="text" name="prodName" size="150" maxlength="200" value="${name}">

<p>产品短名称<b>* 最多20字</b></p>
<input type="text" name="prodShortName" size="150" maxlength="20" value="${title}">

<p>商品详情<b>*</b></p>
<textarea rows="10" cols="150" name="prodDescription">
#{if exhibition}
${exhibition}
    <p style="BACKGROUND-COLOR: rgb(204,0,0); FONT-WEIGHT: bold">
        <span style="font-family:SimSun;font-size:small;color:#ffffff;">温馨提示</span>
    </p>
${prompt}
    <p style="BACKGROUND-COLOR: rgb(204,0,0); FONT-WEIGHT: bold">
        <span style="font-family:SimSun;font-size:small;color:#ffffff;">商品介绍</span>
    </p>
${details}
    <p style="BACKGROUND-COLOR: rgb(204,0,0); FONT-WEIGHT: bold">
        <span style="font-family:SimSun;font-size:small;color:#ffffff;">商户介绍</span>
    </p>
${supplierDes}
#{/if}
#{else}
${prodDescription?.raw()}
#{/else}
</textarea>

<p>商品大图<b>*</b>规格680x425</p>
<input type="text" name="prodImg" size="150" value="${imageLargePath}">

<p>手机端特别提示<b>*</b></p>
<textarea rows="10" cols="150" name="mobileDescription">
#{if exhibition}
${exhibition}
    <p style="BACKGROUND-COLOR: rgb(204,0,0); FONT-WEIGHT: bold">
        <span style="font-family:SimSun;font-size:small;color:#ffffff;">温馨提示</span>
    </p>
${prompt}
    <p style="BACKGROUND-COLOR: rgb(204,0,0); FONT-WEIGHT: bold">
        <span style="font-family:SimSun;font-size:small;color:#ffffff;">商品介绍</span>
    </p>
${details}
    <p style="BACKGROUND-COLOR: rgb(204,0,0); FONT-WEIGHT: bold">
        <span style="font-family:SimSun;font-size:small;color:#ffffff;">商户介绍</span>
    </p>
${supplierDes}
#{/if}
#{else}
${mobileDescription?.raw()}
#{/else}
</textarea>

<p>
    是否配送<b>*</b>
    <input type="radio" name="isSend" value="0" #{if isSend=='0'}checked#{/if}>不配送
    <input type="radio" name="isSend" value="1"#{if isSend=='1'}checked#{/if}> 配送
    快递费
    <input type="text" name="expressMoney" value="${expressMoney}">元
</p>

<p>发布城市<b>*</b></p>
<table border="0" id="cityId"></table>

<p>旅游目的城市，酒店类团购须此字段</p>
<table border="0" id="travelCityId"></table>

<p>列表页短标题<b>*</b></p>
<input type="text" name="listShortTitle" size="150" value="${listShortTitle}">

<p>
    团购开始时间<b>*</b>
    <input type="text" name="startTime" onfocus="WdatePicker({readOnly:true})" class="Wdate"
           value="${new java.util.Date().format()}">
    团购结束时间<b>*</b>
    <input type="text" name="endTime" onfocus="WdatePicker({readOnly:true})" class="Wdate"
           value="${endTime?.format()}">
    券有效期<b>*</b>
    <input type="text" name="deadline" onfocus="WdatePicker({readOnly:true})" class="Wdate"
           value="${deadline?.format()}">
</p>

<p>
    团购成功数量<b>*</b> <input type="text" name="successNum" value="${successNum}">
    总的库存，0为无限制<b>*</b> <input type="text" name="saleMaxNum" value="${saleMaxNum}">
</p>

<p>
    用户单笔最大购买数量，0为无限制<b>*</b> <input type="text" name="buyerMaxNum" value="${buyerMaxNum}">
    用户单笔最低购买数量，大于等于1<b>*</b> <input type="text" name="buyerMinNum" value="${buyerMinNum}">
</p>

<p>
    商品原价<b>*</b> <input type="text" name="prodPrice" value="${faceValue}">
    团购价<b>*</b> <input type="text" name="groupPrice" value="${salePrice}">
</p>

<p>是否支持退款<b>*</b></p>
<input type="radio" name="isRefund" value="1" checked> 支持
<input type="radio" name="isRefund" value="0"> 不支持
<p>手机端广告图</p>
<input type="text" name="mobileImg" size="150" value="${mobileImg}">

<p>团购特别提示内容</p>
<textarea rows="10" cols="150" name="specialmessage">${specialmessage}</textarea>

<h1 style="font-size:200%">商家信息</h1>
#{list items:shopList, as:'shop'}
<h1>门店${shop_index}</h1>
<input type="hidden" name="partnerId_${shop_index}" value="${shop?.id}">

<p>商家名称(最大100个字符)<b>*</b></p>
<input type="text" name="title_${shop_index}" size="150" value="${supplier.otherName} ${shop.name}">

<p>商家名称缩写(最大50个字符)<b>*</b></p>
<input type="text" name="shortTitle_${shop_index}" size="150" value="${supplier.otherName} ${shop.name}">

<p>商圈<b>*</b></p>
一百券商圈：<input type="text" size="50" value="${shop.areaName}">
58商圈：   #{select "circleId_${shop_index}", id:"circleId_${shop_index}"}#{/select}
<p>商家地址</p>
<input type="text" name="address_${shop_index}" size="150" value="${shop.address}">

<p>电话<b>*</b></p>
<input type="text" name="telephone_${shop_index}" size="50" value="${shop.phone}">

<p>网址</p>
<input type="text" name="webUrl_${shop_index}" size="150" value=${webUrl}>

<p>交通信息<b>*</b>(一个空格也可以，默认给了空格)</p>
<input type="text" name="busline_${shop_index}" size="150" value="${busline?:' '}">

<p>地图图片</p>
<input type="text" name="mapImg_${shop_index}" size="150" value="${mapImg}">

<p>地图链接</p>
<input type="text" name="mapUrl_${shop_index}" size="150" value="${mapUrl}">

<p>
    地图服务商
    <input type="radio" name="mapServiceId_${shop_index}"
           value="0" #{if mapServiceId ==0 || mapServiceId ==null} checked#{/if}> Google
    <input type="radio" name="mapServiceId_${shop_index}" value="1"#{if mapServiceId ==1} checked#{/if}> Baidu
    <input type="radio" name="mapServiceId_${shop_index}" value="2"#{if mapServiceId ==2} checked#{/if}> Mapbar
</p>

<p>
    地图经纬度 &nbsp;&nbsp;
    经度：<input type="text" name="latitude_${shop_index}" value="${shop.latitude}">
    纬度：<input type="text" name="longitude_${shop_index}" value="${shop.longitude}">
</p>
#{/list}
#{if editShopList?.size()>0}
    #{list items:editShopList, as:'shop'}
    <h1>门店${shop_index}</h1>
    <input type="hidden" name="partnerId_${shop_index}" value="${shop.partnerId}">

    <p>商家名称(最大100个字符)<b>*</b></p>
    <input type="text" name="title_${shop_index}" size="150" value="${shop.name}">

    <p>商家名称缩写(最大50个字符)<b>*</b></p>
    <input type="text" name="shortTitle_${shop_index}" size="150" value="${shop.shortTitle}">

    <p>商圈<b>*</b></p>
    *{<input type="text" name="circleId_${shop_index}" size="150" value="${shop.circleId}">}*
    58商圈：   #{select "circleId_${shop_index}", id:"circleId_${shop_index}"}#{/select}
    <p>商家地址</p>
    <input type="text" name="address_${shop_index}" size="150" value="${shop.address}">

    <p>电话<b>*</b></p>
    <input type="text" name="telephone_${shop_index}" size="50" value="${shop.phone}">

    <p>网址</p>
    <input type="text" name="webUrl_${shop_index}" size="150" value=${shop.webUrl}>

    <p>交通信息<b>*</b>(一个空格也可以，默认给了空格)</p>
    <input type="text" name="busline_${shop_index}" size="150" value="${shop.busline?:' '}">

    <p>地图图片</p>
    <input type="text" name="mapImg_${shop_index}" size="150" value="${shop?.mapImg}">

    <p>地图链接</p>
    <input type="text" name="mapUrl_${shop_index}" size="150" value="${shop?.mapUrl}">

    <p>
        地图服务商
        <input type="radio" name="mapServiceId_${shop_index}"
               value="0" #{if mapServiceId ==0 || mapServiceId ==null} checked#{/if}> Google
        <input type="radio" name="mapServiceId_${shop_index}" value="1"#{if mapServiceId ==1} checked#{/if}> Baidu
        <input type="radio" name="mapServiceId_${shop_index}" value="2"#{if mapServiceId ==2} checked#{/if}> Mapbar
    </p>

    <p>
        地图经纬度 &nbsp;&nbsp;
        经度：<input type="text" name="latitude_${shop_index}" value="${shop.latitude}">
        纬度：<input type="text" name="longitude_${shop_index}" value="${shop.longitude}">
    </p>
    #{/list}
#{/if}
<input type="hidden" name="goodsId" value="${goodsId}">
<input type="hidden" name="shopSize" value="${shopList?.size()>0 ?shopList?.size():editShopList?.size()}">

<p>
    <button type="submit">提交</button>
</p>
</div>
</form>
<script type="text/javascript">

    var data = CITY.data;
    var city = "";
    $.each(eval(data), function (i, item) {
        if (item.cityId == 2 || item.cityId == 4 || item.cityId == 5 || item.cityId == 21 || item.cityId == 36 || item.cityId == 10) {
            city += "<td><input type='checkbox' id='city_" + item.cityId + "' value='" + item.cityId + "' name='cityIds'>"
                    + item.cityName + "<input type='hidden' name='cities' value='" + item.cityId+":"+item.cityName+":"+item.cityEnShortName + "'></td>";
        }
    });
    $("#cityId").html(city);
    var cityIds = '${cityIds}';
    var cityArray = cityIds.split(",");
    for (var i = 0; i < cityArray.length; i++) {
        $("#city_" + cityArray[i]).attr("checked", true);
    }

    var travelCity = "";
    $.each(eval(data), function (i, item) {
        if (item.cityId == 2 || item.cityId == 4 || item.cityId == 5 || item.cityId == 21 || item.cityId == 36 || item.cityId == 10) {
            travelCity += "<td><input type='checkbox' id='travelCity_" + item.cityId + "' value='" + item.cityId + "' name='travelCityIds'>" + item.cityName + "</td>";
        }
    });
    $("#travelCityId").html(travelCity);
    var travelCityIds = '${travelCityIds}';
    var array = travelCityIds.split(",");
    for (var i = 0; i < array.length; i++) {
        $("#travelCity_" + array[i]).attr("checked", true);
    }

    var areasData = AREA.data;
    var option = "<option value=''>---请选择---</option>";
    $.each(eval(areasData), function (i, item) {
        if (item.cityId == 2 || item.cityId == 4 || item.cityId == 5 || item.cityId == 21 || item.cityId == 36 || item.cityId == 10) {
            option += "<option value='" + item.circleId + "' t='" + item.circleName + "'>" + item.circleName + "</option>";
        }
    });

    if (${jsonArray?.raw()} != null ) {
        var shopArray = ${jsonArray.raw()};
        for (var i = 0; i < shopArray.length; i++) {
            var areaName = shopArray[i]['areaName'];
            var op = " option[t='" + areaName + "']";
            $("#circleId_" + (i + 1)).append(option);
            $("#circleId_" + (i + 1) + op).attr("selected", true)
        }
    }


    var editShopArray = ${new com.google.gson.Gson().toJson(editShopList).raw()};
    for (var i = 0; i < editShopArray.length; i++) {
        $("#circleId_" + (i + 1)).append(option);
        $("#circleId_" + (i + 1)).val(editShopArray[i]['circleId']);
    }
    var categoryData = CATEGORY.data;
    $.each(eval(categoryData), function (i, item) {
        $("<option value='" + item.prodTypeId + "'>" + item.name + "</option>").appendTo($("#category"));
    });
    $("#category").val(${prodTypeId});


</script>
