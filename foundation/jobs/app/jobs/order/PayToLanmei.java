package jobs.order;

import models.jobs.JobWithHistory;
import models.jobs.annotation.JobDefine;
import models.order.OrderItems;
import play.db.jpa.JPA;
import play.jobs.On;

import javax.persistence.EntityManager;
import javax.persistence.Query;
import java.util.ArrayList;
import java.util.List;

/**
 * User: wangjia
 * Date: 13-8-2
 * Time: 下午5:54
 */
@JobDefine(title = "给蓝莓商户打款", description = "给蓝莓商户打款")
@On("0 0 3 * * ?")
//@OnApplicationStart
public class PayToLanmei extends JobWithHistory {
    @Override
    public void doJobWithHistory() {
        List<Long> goodsIds = new ArrayList<>();
        goodsIds.add(3182l);
        goodsIds.add(3180l);
        Integer[] tempOrderIds = {128667, 128668, 128669, 128670, 128671, 128672, 128673, 128674, 128675, 126079, 126081, 126082, 126083, 126085, 126086, 126087, 126088, 126090, 126091, 126092, 126096, 126467, 126468, 126470, 126471, 126472, 126504, 126505, 126506, 126507, 126508, 126509, 126510, 126511, 126512, 126513, 126514, 126515, 126516, 126519, 126520, 126521, 126522, 126525, 126526, 126527, 126614, 126615, 126616, 126617, 126618, 126620, 126621, 126622, 126624, 126625, 126626, 126627, 126628, 126629, 126630, 126631, 126632, 126633, 126634, 126635, 126636, 126637, 126639, 126640, 126642, 126643, 126644, 126645, 126646, 126647, 126648, 126650, 126651, 126652, 126653, 126654, 126655, 126656, 126657, 126658, 126659, 126660, 126661, 126662, 126664, 126665, 126666, 126667, 126668, 126669, 126670, 126671, 126672, 126673, 126674, 126675, 126676, 126677, 126678, 126679, 126680, 126681, 126682, 126683, 126684, 126685, 126686, 126687, 126688, 126689, 126690, 126691, 126692, 126693, 126694, 126695, 126696, 126697, 126698, 126699, 126700, 126701, 126702, 126703, 126704, 126705, 126706, 126707, 126708, 126709, 126710, 126711, 126712, 126713, 126714, 126715, 126716, 126717, 126718, 126720, 126721, 126722, 126723, 126724, 126725, 126726, 126727, 126728, 126729, 126730, 126731, 126732, 126733, 126734, 126735, 126736, 126737, 126738, 126739, 126740, 126741, 126742, 126743, 126744, 126745, 126746, 126747, 126748, 126749, 126750, 126753, 126754, 126755, 126756, 126757, 126758, 126759, 126760, 126761, 126762, 126763, 126764, 126765, 126766, 126767, 126769, 126770, 126771, 126772, 126773, 126774, 126775, 126776, 126777, 126778, 126779, 126780, 126781, 126782, 126783, 126784, 126785, 126786, 126787, 126788, 126789, 126790, 126791, 126792, 126793, 126794, 126795, 126796, 126797, 126798, 126799, 126800, 126801, 126802, 126803, 126804, 126805, 126806, 126807, 126808, 126809, 126810, 126811, 126812, 126813, 126814, 126815, 126816, 126817, 126818, 126819, 126820, 126821, 126822, 126823, 126824, 126825, 126826, 126827, 126828, 126829, 126830, 126831, 126832, 126833, 126834, 126835, 126836, 126837, 126838, 126839, 126840, 126841, 126842, 126843, 126844, 126845, 126846, 126847, 126848, 126849, 126850, 126851, 126852, 126853, 126854, 126855, 126856, 126857, 126858, 126859, 126860, 126861, 126862, 126863, 126864, 126865, 126866, 126867, 126868, 126869, 126870, 126871, 126872, 126873, 126874, 126875, 126876, 126877, 127443, 127444, 127446, 127447, 127448, 127449, 127450, 127451, 125196, 125197, 125198, 125199, 125200, 125201, 125202, 125203, 124901, 124902, 124903, 124904, 124905, 124906, 124907, 124908, 124909, 124910, 124913, 124914, 124915, 124916, 124917, 124918, 124919, 124920, 124921, 124922, 124923, 124924, 124925, 124926, 124927, 124928, 124929, 124930, 124931, 124932, 124933, 124934, 124935, 124936, 124937, 124938, 124939, 124940, 124941, 124942, 124943, 124458, 124459, 124460, 124461, 124462, 124463, 124464, 124465, 124466, 124467, 124468, 124135, 124136, 124137, 124138, 124139, 124140, 124141, 124142, 124143, 124144, 124145, 124146, 124147, 124148, 124149, 124063, 124064, 124065, 124066, 124067, 124068, 124069, 124070, 124071, 124072, 124073, 124074, 124075, 124077, 124078, 124079, 124080, 124081, 124082, 128118, 128955, 128963, 130004, 130005, 130006, 130007, 130008, 130009, 130010, 130011, 130012, 130013, 130014, 130015, 130016, 130017, 130018, 130019, 130020, 130021, 128961, 129002, 129003, 129004, 129005, 129006, 131807, 131827, 131828, 131829, 131830, 133034, 133036, 133037, 133038};
        List<Long> orderIds = new ArrayList<>();
        for (Integer orderId : tempOrderIds) {
            orderIds.add(Long.valueOf(orderId.toString()));
        }

        EntityManager entityManager = JPA.em();
        Query q = entityManager.createQuery("SELECT o FROM OrderItems o  WHERE o.goods.id in (:goodsId) and " +
                " o.order.id not in (:orderIds)");
        q.setParameter("goodsId", goodsIds);
        q.setParameter("orderIds", orderIds);
        List<OrderItems> orderItemsList = q.getResultList();
        for (OrderItems item : orderItemsList) {
            item.realGoodsPayCommission();
        }
    }


}
