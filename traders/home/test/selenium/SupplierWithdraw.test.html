#{fixture delete:[
models.admin.SupplierUser.class,
models.admin.SupplierRole.class,
models.accounts.WithdrawBill.class
],
load:['fixture/roles.yml','fixture/supplierusers.yml'] /}

%{
    id = play.test.Fixtures.idCache.get("models.admin.SupplierUser-user3");
    user = models.admin.SupplierUser.findById(id);
    account = models.accounts.util.AccountUtil.getAccount(user.supplier.getId(), models.accounts.AccountType.SUPPLIER)
    account.amount = new java.math.BigDecimal("300.00")
    account.save()

    withdrawAccount = new models.accounts.WithdrawAccount()
    withdrawAccount.accountType= account.accountType
    withdrawAccount.userId = account.uid
    withdrawAccount.userName="zhangsan"
    withdrawAccount.bankCity = "bank city"
    withdrawAccount.bankName = "bank name"
    withdrawAccount.subBankName = "sub bank name"
    withdrawAccount.cardNumber = "card number"
    withdrawAccount.save()
}%

#{selenium '测试提现'}
    #{include 'test/selenium/step/login.selenium' /}

openAndWait('/withdraw')
clickAndWait('link=申请提现')
click('name=withdrawAccountId')
type('name=amount','1')
clickAndWait('css=button.btn.btn-primary')
verifyTextPresent('提现金额不能小于10元')
type('name=amount','400')
clickAndWait('css=button.btn.btn-primary')
verifyTextPresent('不能大于余额')
type('name=amount','20')
clickAndWait('css=button.btn.btn-primary')
verifyTextPresent('待审批')
clickAndWait('link=查看详情')
verifyTitle('提现详情')
verifyTextPresent('待审批')
clickAndWait('link=返回')
verifyTitle('提现')

#{/selenium}
