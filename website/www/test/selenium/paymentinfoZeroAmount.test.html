#{fixture delete:[models.order.Order.class,models.sales.Category.class,models.sales.Area.class,
models.sales.Shop.class, models.sales.Goods.class,models.order.OrderItems.class,
models.order.ECoupon.class,
models.consumer.User.class,
models.accounts.Account.class
] ,
load:['fixture/categories_unit.yml','fixture/areas_unit.yml','fixture/brands_unit.yml',
'fixture/user.yml',
'fixture/shops_unit.yml','fixture/goods_unit.yml',
'fixture/accounts.yml', 'fixture/account_uhuila.yml','fixture/payment_source.yml', 'fixture/orders.yml'] /}

%{
id = play.test.Fixtures.idCache.get("models.consumer.User-user");
user = models.consumer.User.findById(id);

id = play.test.Fixtures.idCache.get("models.order.Order-order1");
order = models.order.Order.findById(id);
order.setUser(user.getId(), models.accounts.AccountType.CONSUMER);

id = play.test.Fixtures.idCache.get("models.order.Order-order_unpaid");
order = models.order.Order.findById(id);
order.setUser(user.getId(), models.accounts.AccountType.CONSUMER);
order.save()
//此时order.needPay 是0, 因此默认应该勾选使用余额支付
}%


#{selenium "测试支付0元"}
    #{include 'test/selenium/step/login.selenium' /}
	openAndWait('/payment_info/${order.orderNumber}')
    assertTitle('一百券 - 确认付款')
    *{verifyNotVisible('id=other-pay')}*
    *{verifyVisible('id=confirm-pay')}*
    clickAndWait('id=confirm')
    verifyTextPresent('恭喜您付款成功')
    openAndWait('/payment_info/${order.orderNumber}')
    verifyTextPresent('已被处理')
#{/selenium}




*{
#{selenium "测试使用支付宝"}
    #{include 'test/selenium/step/login.selenium' /}
    openAndWait('/payment_info/${order.orderNumber}')
    click('id=alipay')
    verifyTitle('一百券 - 确认付款')
    verifyTextPresent('您已选择 支付宝')
    clickAndWait('id=confirm_pay')
    verifyTitle('支付宝 - 网上支付 安全快速！')
    verifyTextPresent('收款方： 上海视惠信息科技')

#{/selenium}
}*

