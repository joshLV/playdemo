#{fixture delete:[models.order.Order.class,models.sales.Category.class,models.sales.Area.class,
models.sales.Shop.class, models.sales.Goods.class,models.order.OrderItems.class,
models.order.ECoupon.class,
models.consumer.User.class,
models.accounts.Account.class
] ,
load:['fixture/categories_unit.yml','fixture/areas_unit.yml','fixture/brands_unit.yml',
'fixture/user.yml',
'fixture/shops_unit.yml','fixture/goods_unit.yml',
'fixture/accounts.yml', 'fixture/account_uhuila.yml','fixture/payment_source.yml', 'fixture/orders.yml'] /}

%{
    id = play.test.Fixtures.idCache.get("models.consumer.User-user");
    user = models.consumer.User.findById(id);

    id = play.test.Fixtures.idCache.get("models.order.Order-order1");
    order = models.order.Order.findById(id);
    order.setUser(user.getId(), models.accounts.AccountType.CONSUMER);

    id = play.test.Fixtures.idCache.get("models.order.Order-order_unpaid");
    order = models.order.Order.findById(id);
    order.setUser(user.getId(), models.accounts.AccountType.CONSUMER);
    order.needPay = new java.math.BigDecimal("10.00")
    order.save()

    account = models.accounts.util.AccountUtil.getAccount(user.getId(), models.accounts.AccountType.CONSUMER)
    account.amount = new java.math.BigDecimal("5.00")
    account.save();

//此时order.needPay 是10,余额是5  因此当选择使用余额支付时,网银支付无需隐藏
}%


#{selenium "测试全部使用余额支付"}
    #{include 'test/selenium/step/login.selenium' /}
	open('/payment_info/${order.orderNumber}')
    assertTitle('一百券 - 确认付款')
    verifyTextPresent('总金额 ' + ${order.needPay})
    verifyTextPresent('可用余额：' + ${account.amount})
    *{verifyVisible('id=other-pay')}*
    *{verifyNotVisible('id=confirm-pay')}*
    click('id=use_balance')

    *{verifyVisible('id=other-pay')}*
    *{verifyNotVisible('id=confirm')}*

    clickAndWait('id=confirm')
    verifyTextPresent('支付 ' + ${order.needPay.subtract(account.amount)})
#{/selenium}

