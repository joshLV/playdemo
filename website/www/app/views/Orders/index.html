#{extends 'main.html' /}
#{set title:'一百券 - 确认订单信息' /}
#{set 'moreStyles'}
    #{asset.css src:['/y/cart/flowstep.css', '/y/cart/order.css'] /}
#{/set}
#{set 'moreScripts'}
    #{asset.js src:['/y/order.js'] /}
#{/set}

<div id="content">
    <div class="flowstep step2"></div>
#{if rCartList.size()>0}
    <div class="order">
        <div class="addr" id="J_addr">
        #{if address == null}
            <div class="addr-hd"><b>收货地址</b> <span id="address_info" style="display:inline;color: #ff0000">#{error 'address'/}</span></div>
            <div class="addr-bd">
                #{include '/Addresses/form.html'/}
            </div><!-- .addr-hd -->
        #{/if}
        #{else}
            #{include '/Addresses/show.html'/}
        #{/else}
        </div>
        <table class="orderlist">
            <caption>产品清单</caption>
            <thead>
                <tr>
                    <th align="left">商品</th>
                    <th width="80">单价（元）</th>
                    <th width="50">数量</th>
                    <th width="80">小计</th>
                </tr>
            </thead>
            <tbody>
                #{set i:0} #{/set}
                #{list rCartList, as:'rCart'}
                <tr>
                    <td style="text-align:left">${rCart.goods.name}</td>
                    <td>${rCart.goods.salePrice}</td>
                    <td>${rCart.number}</td>
                    *{#{if (++i) == 1 }}*
                    <td valign="middle">
                        ${(rCart.goods.salePrice*rCart.number).formatCurrency('CNY').raw()}<br/>
                        </td>
                    *{#{/if}}*
                </tr>
                #{/list}
                #{set i:0} #{/set}
            <tbody>
        </table>
        <div class="freight" style="border-top: 1px solid #7A7F89">运费：${models.order.Order.FREIGHT.formatCurrency('CNY').raw()}元</div>
        <div class="subtotal">商品共${rCartList?.size()}件，合计：<em>${rCartAmount}</em>元</div>
    </div><!-- .order -->
#{/if}

    #{form @Orders.create(), id:'order_create_form' }
    #{if eCartList.size()>0}
    <div class="order">
        <div class="mobi">
            <div class="mobi-hd">电子凭证-收货手机</div>
            <div class="mobi-bd">
                <div class="receive-mobi"><em>*</em>接收手机：<input type="text" class="mobi-num" name="mobile" value="${user?.mobile}" id="ecart_mobile" />
                 <span style="display: inline;color: #ff0000;" id="limit">#{error 'mobile'/}</span></div>
                <dl><dt>历史手机：</dt>
                    <dd class="history-mobi">
                         #{list orderItems_mobiles, as:'item'}
                             <span class="mobi-item">${item}</span>
                         #{/list}
                    </dd>
                </dl>
            </div>
        </div>
        <table class="orderlist">
            <caption>产品清单</caption>
            <thead>
                <tr>
                    <th align="left">商品</th>
                    <th width="80">单价（元）</th>
                    <th width="50">数量</th>
                    <th width="80">小计</th>
                </tr>
            </thead>
            <tbody>
                #{set j:0/}
                #{list eCartList, as:'eCart'}
                <tr>
                    <td style="text-align:left">${eCart.goods.name}
                    #{if eCart.goods.limitNumber > 0}
                        <span id="limitNumber" style="color:#f50">（限购${eCart.goods.limitNumber}件）
                    #{/if}
                    </td>
                    <td>${eCart.goods.salePrice.formatCurrency('CNY').raw()}</td>
                    <td>${eCart.number}</td>
                    *{#{if (++j) == 1 }}*
                    <td valign="middle">${(eCart.number*eCart.goods.salePrice).formatCurrency('CNY').raw()}</td>
                    *{#{/if}}*
                </tr>
                #{/list}
            <tbody>
        </table>
        <div class="subtotal" style="border-top: 1px solid #7A7F89">商品共${eCartList?.size()}件，合计：<em>${eCartAmount.formatCurrency('CNY').raw()}</em>元</div>
    </div><!-- .order -->
     #{/if}
    #{if rCartList.size() > 0 || eCartList.size() > 0}
    <div class="explain">
        <div class="explain-hd" id="J_explainHd">附加说明</div>
        <div class="explain-bd"><textarea class="explain-text" id="J_explainText" name="remark" style="display:none"></textarea></div>
    </div><!-- .explain -->
    <div class="totalize">
        商品共${rCartList.size()+eCartList.size()}件，总合计：<em>${totalAmount.formatCurrency('CNY').raw()}</em>元
        <a class="confirm-order" id="J_confirmOrder" href="#">确认下单<b></b></a>
    </div><!-- .totalize -->
    #{/if}
    #{else}
        对不起，您的购物车内没有商品
    #{/else}

    <input type="hidden" name="items" id="items" value="${items}" />
    <input type="hidden" id="addressId" />
    #{/form}
</div>
