#{fixture delete:[models.consumer.User.class,models.order.Order.class,models.sales.Category.class,models.sales.Area.class,
models.sales.Shop.class, models.sales.Goods.class,models.order.OrderItems.class,models.order.ECoupon.class,models.accounts.AccountSequence.class,
models.accounts.Account.class,models.accounts.PaymentSource.class] ,
load:['fixture/user.yml','fixture/goods_base.yml','fixture/goods.yml','fixture/orders.yml','fixture/orderItems.yml',
'fixture/accounts.yml','fixture/account_sequence.yml','fixture/pament_source.yml'] /}

%{
     
        orderId = play.test.Fixtures.idCache.get("models.order.Order-order1");
        id = play.test.Fixtures.idCache.get("models.accounts.AccountSequence-seq_001");
        sequence = models.accounts.AccountSequence.findById(id);
        sequence.orderId=orderId;
        sequence.save();
          
        orderId = play.test.Fixtures.idCache.get("models.order.Order-order2");
        id = play.test.Fixtures.idCache.get("models.accounts.AccountSequence-seq_002");
        sequence = models.accounts.AccountSequence.findById(id);
        sequence.orderId=orderId;
        sequence.save();
          
        orderId = play.test.Fixtures.idCache.get("models.order.Order-order3");
        id = play.test.Fixtures.idCache.get("models.accounts.AccountSequence-seq_003");
        sequence = models.accounts.AccountSequence.findById(id);
        sequence.orderId=orderId;
        sequence.save();
        
        userId = play.test.Fixtures.idCache.get("models.consumer.User-selenium");
        id = play.test.Fixtures.idCache.get("models.accounts.Account-Account_1");
        accounts = models.accounts.Account.findById(id);
        accounts.uid=userId;
        accounts.accountType=models.accounts.AccountType.CONSUMER;
        accounts.save();
       
        list = models.accounts.AccountSequence.findAll();
        for (models.accounts.AccountSequence sequence:list) {
            sequence.account = accounts;
            sequence.save();
        }
}%

#{selenium "查看资金明细"}
    #{include 'test/selenium/step/login.selenium' /}
    open('/orders')
    clickAndWait('id=amount')
    assertTitle('一百券 - 资金明细')
    verifyTextPresent('selenium@uhuila.com')
    verifyTextPresent('1000.02')
    type('id=sequenceFlag','收入')
    verifyTextPresent('001')
    verifyTextPresent('002')
    open('/orders')
    clickAndWait('id=amount')
    type('id=tradeType','支付')
    verifyTextPresent('001')
    verifyTextPresent('002')
    
#{/selenium}
