#{extends 'main.html' /}
#{set title:'申请退款' /}
#{set 'moreStyles'}
<link href="@{'/public/stylesheets/my_good.css'}" rel="stylesheet" type="text/css"/>
<link href="@{'/public/stylesheets/user-center.css'}" rel="stylesheet" type="text/css"/>
<style>
.order-info {
    padding: 5px 0 8px;
}
.order-tab td {
    padding: 5px;
}
.btn-box {
    padding: 10px 0 10px 6px;
}
.btn-box #refund {
    padding: 3px 10px;
    margin-left: 10px;
}
</style>
#{/set}
<div class="wrap clearfix">
#{breadcrumbs/breadcrumb breadcrumbs/}
    <h3 style="padding:10px 0 5px;font-size:16px;">申请退款</h3>
    <div class="order-info">
        <span class="order-no">订单号：${order.orderNumber}</span>
        <span class="order-deal">成交时间：${order.createdAt?.format("yyyy-MM-dd HH:mm:ss")}</span>
        <span class="order-paytime">付款时间：${order.paidAt?.format("yyyy-MM-dd HH:mm:ss")}</span>
        <span>订单状态：&{'order.'+order.status}</span>
    </div>
    <form action="/orders/batch-refund" method="post">
    <table class="order-tab" cellpadding="0" cellspacing="0">
        <thead>
            <tr class="col-name">
                <th width="70">&nbsp;</th>
                <th width="340"><span class="th_shop_text">商品</span></th>
                <th width="169"><span class="th_shop_text">收货手机</span></th>
                <th width="69">单价（元）</th>
                <th width="163">券号</th>
                <th width="193">券状态</th>
            </tr>
        </thead>
        <tbody>
        #{list items:eCoupons, as:'coupon' }
            <tr>
                <td>
                   #{if coupon.status == models.order.ECouponStatus.UNCONSUMED }
                   <input type="checkbox" id="check_coupon_${coupon.id}" value="${coupon.id}" name="couponIds"/>
                   #{/if}
                </td>
                <td align="center" valign="middle">${coupon.goods.name}</td>
                <td width="69" align="center" valign="middle">${coupon.orderItems.phone}</td>
                <td width="69" align="center" valign="middle">${coupon.salePrice?.formatCurrency('CNY').raw()}</td>
                <td align="center" valign="middle">${coupon?.eCouponSn}</td>
                <td align="center" valign="middle">&{'coupon.'+coupon.status}</td>
            </tr>
        #{/list }
        </tbody>
    </table>
    <div class="btn-box">
        <label><input class="th_one_input" type="checkbox" name="select_all_checkbox" />全选</label>
        <input type="submit" id="refund" value="申请退款">
        <input type="hidden" value="${order.orderNumber}" name="orderNumber">
    </div>
    </form>
</div>
<br/>
<br/>
<script>
var set_all_select_all_checkbox =function(checked){
    $("input[name=select_all_checkbox]").each(function(){
        this.checked = checked
    });
};
var set_all_goods_checkbox = function(checked){
    $("input[id^=check_coupon_]").each(function(){
        this.checked = checked
    });
};

$("#refund").click(function(){
	var cnt =0;
    $("input[id^=check_coupon_]").each(function(){
       if (this.checked == true) {
    	   cnt++;
       }
    });
    if (cnt == 0) {
    	alert("请选择一条数据！");
    	return false;
    }
});

var all_checked= function(){
    var all_check = true;
    $("input[id^=check_coupon_]").each(function(){
        if(this.checked){
            return true;
        }else{
            all_check = false;
            return false;
        }
    });

    return all_check;
};

$(window).load(
    function(){
    //点击全选
    $("input[name=select_all_checkbox]").each(function(){
        $(this).click(
            function(){
                if(this.checked){
                    set_all_select_all_checkbox(true);
                    set_all_goods_checkbox(true);
                }else{
                    set_all_select_all_checkbox(false);
                    set_all_goods_checkbox(false);
                }
            }
            )});
    //点击单个复选框
    $("input[id^=check_coupon_]").each(function(){
        $(this).click( function(){
            if(all_checked()){
                set_all_select_all_checkbox(true);
            }else{
                set_all_select_all_checkbox(false);
            }
        })
    });
});
</script>
