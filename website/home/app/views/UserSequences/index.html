#{extends 'main.html' /}
#{set title:'一百券 - 资金明细' /}
#{set 'moreStyles'}
    #{asset.css src:['/y/user/userBase.css', '/y/user/userSequences.css'] /}
<style type="text/css">
    #full_bg {
        background-color: Gray;
        display: none;
        z-index: 3;
        position: absolute;
        left: 0px;
        top: 0px;
        filter: Alpha(Opacity = 30); /* IE */
        -moz-opacity: 0.4; /* Moz + FF */
        opacity: 0.4;
    }

    #apply_dialog {
        position: absolute;
        width: 400px;
        height: 200px;
        background: white;
        display: none;
        z-index: 5;
    }
</style>
#{/set}
#{set 'moreScripts'}
<script src="@{'/public/javascripts/My97DatePicker/WdatePicker.js'}" type="text/javascript" charset="UTF-8"></script>
<script>
    $(function () {
        $("#tradeType").change(function () {
            $('#amountFrm').submit();
        });
        $("#sequenceFlag").change(function () {
            $('#amountFrm').submit();
        });
    });
</script>
#{/set}
<div id="content" class="clearfix">
#{include "share/left.html"/}
    <div class="section">
    #{breadcrumbs/breadcrumb breadcrumbs/}
        <form class="form-horizontal" id="amountFrm" action="@{UserSequences.index()}" method="GET">
            <div class="user-account">
                账户：<strong>${user?.loginName}</strong> 可提现账户余额：<span>${account.amount}</span>元 不可提现账户余额：<span>${account.promotionAmount?:"0.00"}</span>元
            </div>
            <div class="search-box">
                <label>资金流向：</label>
            #{select 'condition.sequenceFlag', id:'sequenceFlag', value:condition?.sequenceFlag}
                #{option ""}不限#{/option}
                #{option "VOSTRO"}收入#{/option}
                #{option "NOSTRO"}支出#{/option}
            #{/select}
                <label>成交时间：</label>
                <input class="short_input Wdate" type="text" name="condition.createdAtBegin" id="createdAtBegin"
                       value="${condition?.createdAtBegin?.format()}" onfocus="WdatePicker({readOnly:true})"/>
                -
                <input class="short_input Wdate" type="text" id="createdAtEnd" name="condition.createdAtEnd"
                       value="${condition?.createdAtEnd?.format()}" onfocus="WdatePicker({readOnly:true})"/>
                <button class="search-btn" id="search"> 搜　索</button>
            </div>
            <table class="order-tab">
                <thead>
                <tr class="col-name">
                    <th width="165">流水号</th>
                    <th width="80">时间</th>
                    <th width="100">可提现/不可提现余额</th>
                    <th>名称/备注
                    #{select 'condition.tradeType', id:'tradeType',class:'order-status', value:condition?.tradeType}
                        #{option ''}交易类型#{/option}
                        #{option "CHARGE"}&{'accountSequence.CHARGE'}#{/option}
                        #{option "WITHDRAW"}&{'accountSequence.WITHDRAW'}#{/option}
                        #{option "PAY"}&{'accountSequence.PAY'}#{/option}
                        #{option "REFUND"}&{'accountSequence.REFUND'}#{/option}
                    #{/select}
                    </th>
                    <th width="80">支出</th>
                    <th width="80">收入</th>
                    <th width="80">支付方式</th>
                </tr>
                </thead>
            #{paginate.list items:amountList, as:'accountSequence'}
                <tbody>
                <tr class="sep-row">
                    <td colspan="7"></td>
                </tr>
                <tr class="order-bd">
                    <td align="center">${accountSequence.serialNumber}</td>
                    <td align="center">${accountSequence.createdAt.format('yyyy-MM-dd HH:mm:ss')}</td>
                    <td align="center">
                        ${accountSequence.balance?.formatCurrency('CNY')}/
                        ${accountSequence.promotionBalance?.formatCurrency('CNY')?:"0.00"}
                    </td>
                    <td>${accountSequence.remark}
                        #{if accountSequence.orderId != null && accountSequence.tradeType.isOrder()}
                            <br/>订单号：<a style="color:#3366CC" href="/orders/${accountSequence.orderId}"
                                        target="_blank">${accountSequence?.orderNumber}</a>
                        #{/if}
                    </td>
                    <td align="center"
                        class="expend">
                        #{if accountSequence.sequenceFlag == models.accounts.AccountSequenceFlag.NOSTRO}
                            ${accountSequence.changeAmount.add(accountSequence.promotionChangeAmount?:java.math.BigDecimal.ZERO)}
                        #{/if} </td>
                    <td align="center"
                        class="income">#{if accountSequence.sequenceFlag == models.accounts.AccountSequenceFlag.VOSTRO}
                        +${accountSequence.changeAmount.add(accountSequence.promotionChangeAmount?:java.math.BigDecimal.ZERO)} #{/if}</td>
                    <td align="center">${accountSequence?.payMethod}</td>
                </tr>
                </tbody>
            #{/paginate.list}
            </table>
        </form>

        <div class="pagination">
            <ul>#{paginate.controls items:amountList /}</ul>
        </div>

    </div>
</div>
