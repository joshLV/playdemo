#{extends 'layout_operate/layout.html' /}
#{set title:'销售报表' /}
#{include '/share/nav.html' /}
#{set 'moreScripts'}
<script src="@{'/public/javascripts/My97DatePicker/WdatePicker.js'}" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript" charset="utf-8">
    $(function () {

        $("[start]").each(function () {
            $(this).click(function () {
                if ($(this).parent().attr("class") == 'active') {
                    return false;
                }
                var today = new Date();
                var endDay = new Date();
                var startDay = new Date();

                startDay.setDate(today.getDate() - 1)
                endDay.setDate(today.getDate() - 1)

                var interval = $(this).attr("start");
                var sig = interval.charAt(interval.length - 1);
                var count = parseInt(interval.substring(0, interval.length - 1));
                if (sig == 'd') {
                    startDay.setDate(startDay.getDate() - count);
                } else if (sig == 'm') {
                    startDay.setMonth(startDay.getMonth() - count);
                } else if (sig == 'y') {
                    startDay.setFullYear(startDay.getFullYear() - count);
                }

                $("#condition_begin").val(startDay.getFullYear() + "-" + (startDay.getMonth() + 1) + "-" + startDay.getDate());
                $("#condition_end").val(today.getFullYear() + "-" + (today.getMonth() + 1) + "-" + endDay.getDate());
                $("#condition_interval").val(interval);
                $("#search_form").submit();
                return false;
            });
        });

    });
</script>
#{/set}
<div class="body">
    <form action="@{OperationReports.showSalesReport()}" method="GET" id="search_form"
          name="search_form">
        起止日期
        <input type="text" id="condition_begin" class="input-medium Wdate" name="condition.begin"
               onfocus="WdatePicker({readOnly:true})" value="${condition?.begin?.format()}"> -
        <input type="text" id="condition_end" class="input-medium Wdate" name="condition.end"
               onfocus="WdatePicker({readOnly:true})" value="${condition?.end?.format()}">
        <button type="submit" class="btn btn-primary" id="search">搜索</button>
        <ul class="nav nav-pills">
            <li #{if condition.interval=='0d'} class="active" #{/if}  ><a start="0d" href="#">昨天</a></li>
            <li #{if condition.interval=='-1d'} class="active" #{/if}  ><a start="-1d" end="-1d" href="#">今天</a></li>
            <li #{if condition.interval=='7d'} class="active" #{/if}  ><a start="7d" href="#">最近7天</a></li>
            <li #{if condition.interval=='1m'} class="active" #{/if}  ><a start="1m" href="#">1个月</a></li>
            <li #{if condition.interval=='3m'} class="active" #{/if}  ><a start="3m" href="#">3个月</a></li>
        </ul>
        <input type="hidden" id="condition_interval" name="condition.interval"/>
    </form>


    <table class="table table-striped table-bordered table-condensed">
        <thead>
        <th>商品名称</th>
        <th>进价</th>
        <th>平均售价</th>
        <th>销售数量</th>
        <th>总销售额</th>
        </thead>
    #{set i:0/}
    #{paginate.list items:reportPage, as:'report'}
        <tr>
            #{set i:i+1/}
            <td>${(reportPage.pageNumber-1)*reportPage.pageSize+i}</td>
            <td>${report?.referCode == null ? "直接访问" : report?.referCode}</td>
            <td>${report?.visitCount}</td>
            <td>${report?.registerCount}</td>
            <td>${report?.cartCount}</td>
            <td>${report?.orderCount}</td>
            <td>${report?.payAmount?.formatCurrency('CNY')}</td>
        </tr>
    #{/paginate.list}
    </table>
*{#{if reportPage.getPageCount() > 1}}*
*{<div class="pagination">}*
*{<ul>}*
*{#{paginate.controls items:reportPage /}}*
*{</ul>}*
*{</div>}*
*{#{/if}}*
</div>
