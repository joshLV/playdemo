#{extends 'layout_operate/layout.html' /}
#{set title:'商品上下架报表' /}
#{include '/share/nav.html' /}

<form class="well form-inline" action="@{GoodsOnSaleAndOffSaleReports.index()}" method="GET" id="search_form"
      name="search_form">
    商品名称
    <input type="text" name="condition.shortName" value="${condition?.shortName}">
    商品编号：
    <input type="text" name="condition.code" value="${condition?.code}">
    #{list items:resalerList, as:'resaler'}
    <label class="checkbox inline">
        <input type="checkbox" id="resalerIds" name="condition.resaleIds" value="${resaler.resalerId}"
            #{if condition?.resaleIds?.contains(resaler.resalerId)}checked="true" #{/if}>${resaler.resalerName}&nbsp;</label>
    #{/list}
    <button type="submit" class="btn btn-primary" id="search">搜索</button>
</form>
<div class="alert alert-success">
    <span>总计 ： <b>${reportPage?.size()}</b> 笔</span>
</div>
<table class="table table-striped table-bordered table-condensed">
    <thead>
    <th width="10px">编号</th>
    <th width="260px">商品名称</th>
    #{list items:resalerList, as:'resaler'}
    <th width="50px">${resaler.resalerName}</th>
    #{/list}
    <th width="50px">操作</th>
    </thead>
#{paginate.list items:reportPage, as:'report'}
    <tr>
    %{
        rowkey=report?.get("RowKey").split("※");
        name=rowkey[0];
        code=rowkey[1]=='null'? "":rowkey[1];
        id=rowkey[2]=='null'? "":rowkey[2];

        baseUrl=play.Play.configuration.getProperty("uri.operate_business");
        wwwUrl=play.Play.configuration.getProperty("www.url");
        }%
        <td>${code}</td>
        <td><a href="http://${wwwUrl}/p/${id}"
               target="_blank">${name}</a></td>
        #{list items:resalerList, as:'resaler'}
        %{
            goodsReport = report?.get(resaler.resalerName);
            }%
            <td>
                #{if  goodsReport!=null && models.sales.ChannelGoodsInfoStatus.ONSALE==goodsReport?.status}
                    <a href="${goodsReport?.url}" target="_blank"><span
                            style="font-size: 15px;color: green">√</span></a>#{/if}
            *{#{elseif goodsReport!=null && models.sales.ChannelGoodsInfoStatus.PAGE_NOT_EXISTED==goodsReport?.status }}*
            *{<a href="${goodsReport?.url}" target="_blank">查看</a>}*
            *{<span style="font-size: 12px;color: #0000ff;">该页面不存在</span>}*
            *{#{/elseif}}*
                #{else}
                    #{if goodsReport?.status!=null }<a href="${goodsReport?.url}" target="_blank"><span
                            style="color: red">X</span></a>#{/if}
                #{/else}
            </td>

        #{/list}
        <td><a href="${baseUrl}/channel-goods?goodsId=${id}" target="_blank">查看</a></td>
    </tr>
#{/paginate.list}
</table>
<div class="pagination">
    <ul>
    #{paginate.controls items:reportPage /}
    </ul>
</div>

