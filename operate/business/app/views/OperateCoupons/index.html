#{extends 'layout_operate/layout.html' /}
 #{include 'share/nav.html' /}
#{set title:'券号列表' /}
<script type="text/javascript">
	function sendMessage(id){
        $.ajax({
            url: "/coupons-message/"+id+"/send",
            type: 'GET',
            error: function() { alert('发送失败!'); },
            success: function(data) {
                if (data == '0') {
                	alert("发送成功！");
                } else {
                    alert("发送失败!");
                }

            }
        });
		
	}
</script>
<div class="body">
 <legend>券号列表</legend>
 <form class="form-horizontal" name="frmlist" action="@{OperateCoupons.index()}" method="GET">
  <div style="margin-bottom: 12px">
  <button class="btn btn-primary" type="button">导出报表</button> 
  </div>

  <table class="table table-striped table-bordered table-condensed">
   <thead>
    <tr>
     <th>券号</th>
     <th>订单号</th>
     <th>商品名称</th>
     <th>单价</th>
     <th>有效期</th>
     <th>消费时间</th>
     <th>退款时间</th>
     <th>退款金额</th>
     <th>状态</th>
     <th>操作</th>
    </tr>
   </thead>

   <tbody>

    #{paginate.list items:couponsList, as:'coupon'}
    <tr>
    <td>${coupon?.getMaskedEcouponSn()}</td>
    <td>${coupon?.order.orderNumber}</td>
     <td><img src="${coupon?.goods?.imageTinyPath}"/>${coupon?.goods?.name}</td>
     <td>${coupon?.salePrice}</td>
     <td>${coupon?.goods.effectiveAt ?.format()}/
         ${coupon?.goods.expireAt ?.format()}</td>
     <td>${coupon?.consumedAt ?.format("yyyy-MM-dd HH:mm:ss")}</td>
     <td>${coupon?.refundAt ?.format("yyyy-MM-dd HH:mm:ss")}</td>
     <td>${coupon?.salePrice}</td>
     <td>&{'coupon.'+coupon?.status}</td>
     <td>#{if  models.order.ECouponStatus.DEALING.equals(coupon.status) || models.order.ECouponStatus.UNCONSUMED.equals(coupon.status) }
             #{if coupon.isFreeze == 0} 
             #{vx.operateLink name:"freeze_"+coupon.id,text:"冻结",url:"/coupons/"+coupon.id+"/freeze",confirm:true, targetName:coupon?.getMaskedEcouponSn(),method:"PUT"/}
             <a href="javascript:sendMessage(${coupon.id})">发送短信</a>#{/if}
             #{ else } #{vx.operateLink name:"unfreeze_"+coupon.id,text:"解冻", url:"/coupons/"+coupon.id+"/unfreeze", method:"PUT"/}#{/else}
         #{/if}
     
       </td>
    </tr>
    #{/paginate.list}

   </tbody>
  </table>
  <div class="pagination" align="center">
     <ul>
    #{paginate.controls items:couponsList /}
    </ul>
  </div>
   </form>

</div>

