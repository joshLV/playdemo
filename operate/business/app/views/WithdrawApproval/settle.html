#{extends 'layout_operate/layout.html' /}
#{set title:'提现申请详情' /}
#{include '/share/nav.html' /}
#{set 'moreScripts'}
<script src="@{'/public/javascripts/My97DatePicker/WdatePicker.js'}" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
    function settle(withdrawAccountId) {
    $("#withdrawAccountId").val(withdrawAccountId);
    }
</script>
#{/set}
#{set 'moreStyles'}
<style type="text/css">
    .control-label {
    font-weight: bold;
    }

    .control-value {
    line-height: 28px;
    margin-left: 160px;
    }

    .form-horizontal .control-group {
    margin-bottom: 4px;
    }
</style>
#{/set}

<div class="row-fluid">
    <legend>商户资金结算</legend>

    #{if supplierList.size() == 0 }
    <div class="control-group">暂无需结算的商户.</div>
    <a href="/withdraw" class="btn">返回</a>

    #{/if}
    #{else}

    #{form @WithdrawApproval.confirmSettle(), class:'form-horizontal'}

    <div class="form-horizontal">
        #{layout_operate.selectField name:'supplierId', value:supplierId, error:'supplierId',
        class:'span2'}
        #{list items:supplierList, as:'aSupplier' }
        #{option aSupplier?.id}${aSupplier?.otherName==null?aSupplier?.fullName:aSupplier?.otherName}#{/option}
        #{/list}
        #{/layout_operate.selectField}
        #{layout_operate.dateField name:'withdrawDate',
        value:withdrawDate?:com.uhuila.common.util.DateUtil.getYesterday().format('yyyy-MM-dd'), error:'withdrawDate'/}
        <div class="form-actions">
            <button class="btn btn-primary" id="confirmSettle" type="submit">查看商户结算信息</button>
            <!--<a data-toggle="modal" href="#agree-modal" class="btn btn-primary">查看商户结算信息</a>-->
            <a href="/withdraw" class="btn">返回</a>
        </div>
    </div>
    #{/form}

    #{if amount!=null}
    #{form @WithdrawApproval.settle(), class:'form-horizontal', id:'settleForm'}
    <input type="hidden" id="supplierAccount.id" name="supplierAccount.id" value="${supplierAccount.id}">
    <input type="hidden" id="amount" name="amount" value="${amount}">
    <input type="hidden" id="withdrawAccountId" name="withdrawAccountId" value="1">
    <input type="hidden" id="prepaymentId" name="prepaymentId" value="${prepaymentId}">

    <div class="control-group">
        <label class="control-label">商户名称</label>
        <label class="control-value">${supplier?.fullName}
            &nbsp;&nbsp; #{if supplier?.otherName!=null}&nbsp;--&nbsp;${supplier?.otherName}#{/if} &nbsp;&nbsp;
            <a href="/reports/supplier?condition.accountName=${supplier?.fullName}&condition.tradeType=PURCHASE_COSTING"
               target="_blank">账户资金明细</a>
        </label>
    </div>
    <div class="control-group">
        <label class="control-label">结算金额 </label>
        <label class="control-value">${amount.formatCurrency('CNY')}</label>
    </div>
    <div class="control-group">
        <label class="control-label">预付款 </label>
        <label class="control-value">${prepaymentBalance.formatCurrency('CNY')}</label>
    </div>
    <div class="control-group">
        <label class="control-label">实际需打款金额 </label>
        <label class="control-value"><span class="label label-important">${needPay.formatCurrency('CNY')}</span></label>
    </div>
    #{if needPay?.compareTo(java.math.BigDecimal.ZERO)>0}
    <div class="control-group">
        <label class="control-label" for="agree-fee">手续费</label>

        <div class="controls">
            <input type="text" class="input-xlarge" id="agree-fee" name="fee" value="0">元
        </div>
    </div>
    #{/if}
    <div class="control-group">
        <label class="control-label" for="agree-comment">备注</label>

        <div class="controls">
            <textarea rows="3" class="input-xlarge" id="agree-comment" name="comment">无</textarea>
        </div>
    </div>
    #{list items:withdrawAccountList, as:'withdrawAccount'}
    <div class="control-group">
        <label class="control-label">所在城市</label>
        <label class="control-value">${withdrawAccount?.bankCity}</label>
    </div>
    <div class="control-group">
        <label class="control-label">开户银行</label>
        <label class="control-value">${withdrawAccount?.bankName}</label>
    </div>
    <div class="control-group">
        <label class="control-label">分行名称</label>
        <label class="control-value">${withdrawAccount?.subBankName}</label>
    </div>
    <div class="control-group">
        <label class="control-label">开户姓名</label>
        <label class="control-value">${withdrawAccount?.userName}</label>
    </div>
    <div class="control-group">
        <label class="control-label">银行卡号</label>
        <label class="control-value">${withdrawAccount?.cardNumber}</label>
    </div>
    #{if amount?.compareTo(java.math.BigDecimal.ZERO)>0}
    <div class="control-group">
        <label class="control-label"></label>
        <label class="control-value">
            <button class="btn btn-primary" id="settle_${withdrawAccount?.id}"
                    onclick="settle(${withdrawAccount?.id})"/>
            结算</button></label>
    </div>
    #{/if}
    #{/list}
    #{/form}
    #{/if}

    #{/else}


</div>
