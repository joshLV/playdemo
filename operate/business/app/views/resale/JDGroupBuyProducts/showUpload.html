#{extends 'layout_operate/layout.html' /}
#{set title:'京东上传商品:' + goods.shortName /}
#{include '/share/nav.html' /}
#{set 'moreStyles'}
    #{asset.css src:['/ztree/zTreeStyle.css'] /}
    <style type="text/css">
        ul.ztree{
        margin-top: 1px;
        border: 1px solid #ccc;
        background: #f5f5f5;
        overflow-y: scroll;
        overflow-x: auto;
        }
    </style>
#{/set}
<div class="body">
    <legend>京东上传商品：<a href="/goods/${goods.id}" target="_blank">
        ${goods.shortName}</a>
    </legend>
    <form class="form-horizontal" method="POST" action="/resaler-products/jd/upload">
        <div class="control-group">
            <label class="control-label">选择城市/区域/商圈 *</label>
            <div class="controls">
                <input class="input" readonly id="city-show">
                <div id="city-treeFrame" class="menuContent" style="display:none; position: absolute;">
                    <ul id="city-tree" class="ztree" style="width:210px"></ul>
                </div>
                <input name="cityId" id="city-value" type="hidden">
                <input name="cityIdChain" id="city-nodeChain" type="hidden">

                <input name="areas" id="inputAreas" type="hidden">
            </div>
        </div>
        <div class="control-group">
            <label class="control-label">选择分类 *</label>
            <div class="controls">
                <input class="input" readonly id="group-show">
                <div id="group-treeFrame" class="menuContent" style="display:none; position: absolute;">
                    <ul id="group-tree" class="ztree" style="width:210px"></ul>
                </div>
                <input name="groupId" id="group-value" type="hidden">
                <input name="groupIdChain" id="group-nodeChain" type="hidden">
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="inputTeamTitle">团购标题名称 *</label>
            <div class="controls">
                <input type="text" id="inputTeamTitle" class="input-block-level" name="teamTitle" value="${goods.name}">
                <span class="help-block">不超过100个字符</span>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="inputTitle">团购产品标题 *</label>
            <div class="controls">
                <input type="text" id="inputTitle" name="title" class="input-block-level" value="${goods.shortName}">
                <span class="help-block">不超过12个字符</span>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="inputMarketPrice">市场价 *</label>
            <div class="controls">
                <input type="text" id="inputMarketPrice" name="marketPrice" value="${goods.faceValue}">
                <span class="help-inline">最多两位小数</span>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="inputSalePrice">销售价 *</label>
            <div class="controls">
                <input type="text" id="inputSalePrice" name="salePrice" value="${goods.salePrice}">
                <span class="help-inline">不能大于市场价，最多两位小数</span>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label">团购开始时间 *</label>
            <div class="controls">
                <input type="text" name="beginTime" onfocus="WdatePicker({readOnly:true})" class="Wdate" value="${goods.effectiveAt?.format()}">
            </div>
        </div>
        <div class="control-group">
            <label class="control-label">团购结束时间 *</label>
            <div class="controls">
                <input type="text" name="endTime" onfocus="WdatePicker({readOnly:true})"  class="Wdate" value="${goods.expireAt?.format()}">
            </div>
        </div>
        <div class="control-group">
            <label class="control-label">券截止日期 *</label>
            <div class="controls">
                <input type="text" name="couponExpireTime" onfocus="WdatePicker({readOnly:true})"  class="Wdate" value="${goods.expireAt?.format()}">
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="inputMinNumber">最低成团人数 *</label>
            <div class="controls">
                <input type="text" id="inputMinNumber" name="minNumber" value="1">
                <span class="help-inline">必须大于等于1</span>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="inputMaxNumber">商品总量上限 *</label>
            <div class="controls">
                <input type="text" id="inputMaxNumber" name="maxNumber" value="0">
                <span class="help-inline">必须大于等于0，0表示无上限</span>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="inputMaxNumber">单人购买上限 *</label>
            <div class="controls">
                <input type="text" id="inputPerNumber" name="perNumber" value="99">
                <span class="help-inline">仅数字，0表示无上限，最大支持9999</span>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="inputGrouponBImg">团购主图 *</label>
            <div class="controls">
                <input type="text" id="inputGrouponBImg" name="grouponBImg" class="input-block-level" value="${goods.imageOriginalPath}">
                <span class="help-block">http开头，图片尺寸为440*280，图片大小在100kb以内</span>
                <img src="${goods.imageOriginalPath}" alt="" id="imgGrouponBImg">
            </div>
        </div>
        <div class="control-group">
            <label class="control-label">特别提示 *</label>
            <div class="controls">
                <textarea rows="8" cols="100"  name="notice" id="notice" style="width:850px;height:150px;display:hidden;">
                </textarea>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label">团购简介 *</label>
            <div class="controls">
                <textarea rows="8" cols="100"  name="summary" id="summary" style="width:850px;height:150px;display:hidden;">
                </textarea>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label">团购详情</label>
            <div class="controls">
                <textarea rows="8" cols="100"  name="teamDetail" id="teamDetail" style="width:850px;height:550px;display:hidden;">
                    ${goods.exhibition?.raw()}
                    <p style="BACKGROUND-COLOR: rgb(204,0,0); FONT-WEIGHT: bold">
                        <span style="font-family:SimSun;font-size:small;color:#ffffff;">温馨提示</span>
                    </p>
                    ${goods.prompt?.raw()}
                    <p style="BACKGROUND-COLOR: rgb(204,0,0); FONT-WEIGHT: bold">
                        <span style="font-family:SimSun;font-size:small;color:#ffffff;">商品介绍</span>
                    </p>
                    ${goods.details?.raw()}
                    <p style="BACKGROUND-COLOR: rgb(204,0,0); FONT-WEIGHT: bold">
                        <span style="font-family:SimSun;font-size:small;color:#ffffff;">商户介绍</span>
                    </p>
                    ${goods.supplierDes?.raw()}
                </textarea>
            </div>
        </div>
        <div class="form-actions">
            <input type="hidden" name="venderTeamId" value="${goods.id}" >
            <button type="submit" id="submit" class="btn btn-primary">发布</button>
        </div>
    </form>
</div>

#{set 'moreScripts'}
<script src="@{'/public/javascripts/kindeditor-min.js'}" type="text/javascript" charset="UTF-8"></script>
<script src="@{'/public/javascripts/lang/zh_CN.js'}" type="text/javascript" charset="UTF-8"></script>
<script src="@{'/public/javascripts/My97DatePicker/WdatePicker.js'}" type="text/javascript" charset="UTF-8"></script>
#{asset.js src:['/ztree/jquery.ztree.all-3.5.min.js'] /}
<script src="@{'/public/javascripts/ztree-helper.js'}" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">

    var cityTreeCallbacks = {}
    $.extend(cityTreeCallbacks,getSinglePathCallbacks("city-tree"),getOnclickCallback("city"))
    var cityTreeSettings = {
        async: {
            enable: true,
            url:"/jd-ztree/city",
            autoParam:["id", "type"]
        },
        check:{
            enable:true
        },
        data: {
            simpleDate:{
                enable: false
            }
        },
        view: {
            showIcon: false,
            showLine: false,
            dblClickExpand: false
        },
        callback: cityTreeCallbacks
    };

    var groupTreeCallbacks = {}
    $.extend(groupTreeCallbacks,getSinglePathCallbacks("group-tree"),getOnclickCallback("group"))
    var groupTreeSettings = {
        async: {
            enable: true,
            url:"/jd-ztree/group",
            autoParam:["id"]
        },
        check:{
            enable:true,
            chkStyle:"radio",
            radioType:"all"
        },
        data: {
            simpleDate:{
                enable: false
            }
        },
        view: {
            showIcon: false,
            showLine: false,
            dblClickExpand: false
        },
        callback: groupTreeCallbacks
    };

    var defaultCityData =[
            {
                name:"上海",
                id: 34,
                type: "city",
                nocheck: true,
                isParent:true
            }
    ];

    $(function(){
        $.fn.zTree.init($("#city-tree"), cityTreeSettings, defaultCityData);
        $("#city-show").click(showTreeFunc('city'));
        $.fn.zTree.init($("#group-tree"), groupTreeSettings);
        $("#group-show").click(showTreeFunc('group'));

        KindEditor.create('textarea',
        {
            filterMode:false,
            allowFileManager:false
        });
        $("#submit").click(function(){
            var checkedCategory = $.fn.zTree.getZTreeObj("categoryTree").getCheckedNodes(true);
            var categoryChain = buildTreeChain(checkedCategory);

            var checkedMerchantCategory = $.fn.zTree.getZTreeObj("merchantCategoryTree").getCheckedNodes(true);
            var checkedMerchantCategoryStr = buildCheckedStr(checkedMerchantCategory, ",", "id")
            var merchantCategoryChain = buildTreeChain(checkedMerchantCategory);

            $("#inputCategory").val(checkedCategory[0].id);
            $("#inputMerchantCategory").val(checkedMerchantCategoryStr);
            $("#categoryIdChains").val(categoryChain.join(","));
            $("#merchantCategoryIdChains").val(merchantCategoryChain.join(","));
            return true;
        });
    });
</script>
#{/set}
