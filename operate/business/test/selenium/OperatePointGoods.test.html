#{fixture delete:[
models.admin.OperateUser.class,
models.admin.OperateRole.class,
models.sales.PointGoods.class,
models.supplier.Supplier.class],
load:['fixture/roles.yml','fixture/pointGoods.yml','fixture/supplierusers.yml'] /}


#{selenium '批量下架'}
    #{include 'test/selenium/step/login.selenium' /}
    open('/pointgoods')
    click('id=checkoption')
    clickAndWait('id=offsales')
    clickAndWait('link=已下架')
    verifyTextPresent('商品1')
#{/selenium}

#{selenium '同意上架'}
    #{include 'test/selenium/step/login.selenium' /}
    open('/pointgoods')
    clickAndWait('link=已下架')
    click('id=checkoption')
    clickAndWait('id=onsales')
	clickAndWait('link=已上架')
    verifyTextPresent('商品1')

#{/selenium}

#{selenium '添加商品数据-保存按钮验证不保存数据+保存'}
    #{include 'test/selenium/step/login.selenium' /}
    open('/pointgoods')
    clickAndWait('link=积分商品添加')
    assertTitle('添加积分商品')
    verifyTextPresent('电子券')
    verifyTextPresent('实物')
    assertText('css=label.radio.inline','电子券')
    type('id=pointGoods_name','cat10')
    type('id=pointGoods_effectiveAt','2012-08-30')
    type('id=pointGoods_expireAt','2012-08-01')
    type('id=pointGoods_faceValue','100')
    type('id=pointGoods_pointPrice','1000')
    type('id=pointGoods_baseSale','8')
    type('id=pointGoods_limitNumber','10')
    clickAndWait('id=save')
    *{verifyTextPresent('到期时间必须填写未来的时间!')}*
    verifyTextPresent('限量要小于或等于库存!');
    verifyTextPresent(('请输入图片!');
    verifyTextPresent('请输入详情!');
    type('id=pointGoods_effectiveAt','2012-08-20')
    type('id=pointGoods_expireAt','2012-08-30')
    type('id=pointGoods_baseSale','8')
    type('id=pointGoods_limitNumber','10')
    runScript('var element= window.document.getElementsByTagName("iframe")[1];')
    runScript('idocument = element.contentDocument;')
    runScript('element=idocument.getElementsByTagName("body")[0];')
    runScript('element.innerHTML = "this is a test thread";')
    clickAndWait('id=save')
#{/selenium}

#{selenium '添加商品数据-保存并上架按钮'}
    #{include 'test/selenium/step/login.selenium' /}
    open('/pointgoods/new')
    verifyTitle('添加积分商品')
    verifyTextPresent('添加积分商品')
    type('id=pointGoods_name','cat10')
    type('id=pointGoods_effectiveAt','2012-08-20')
    type('id=pointGoods_expireAt','2012-08-30')
    type('id=pointGoods_baseSale','8')
    type('id=pointGoods_limitNumber','10')
    type('id=pointGoods_faceValue','100')
    type('id=pointGoods_pointPrice','1000')
    runScript('var element= window.document.getElementsByTagName("iframe")[1];')
    runScript('idocument = element.contentDocument;')
    runScript('element=idocument.getElementsByTagName("body")[0];')
    runScript('element.innerHTML = "this is a test thread";')
    clickAndWait('id=onsale')
    open('/pointgoods')
    clickAndWait('link=已上架')
    *{verifyTextPresent('cat')    }*
    *{clickAndWait('id=onsale')}*
    *{verifyTitle('积分商品一览')}*
    *{verifyTitle('添加积分商品')}*
    *{verifyTextPresent('无效的图片!')}*
    *{verifyTitle('商品一览')}*
    *{verifyTextPresent('商品一览')}*
#{/selenium}



#{selenium '积分商品一览'}
    #{include 'test/selenium/step/login.selenium' /}
    open('/pointgoods')
    assertTextPresent('积分商品一览')
    select('id=condition_status','label=已上架')
    clickAndWait('id=searchbtn')
    verifyTextPresent('测试积分商品1')
#{/selenium}

#{selenium '查看积分商品'}
    #{include 'test/selenium/step/login.selenium' /}
    open('/pointgoods/${play.test.Fixtures.idCache.get("models.sales.PointGoods-PointGoods1")}')
    verifyTitle('查看积分商品')
    verifyTextPresent('测试积分商品1')
    verifyTextPresent('2000')
#{/selenium}


#{selenium '修改积分商品'}
    #{include 'test/selenium/step/login.selenium' /}
    open('/pointgoods/${play.test.Fixtures.idCache.get("models.sales.PointGoods-PointGoods1")}/edit')
    verifyTitle('修改积分商品')
    type('id=pointGoods_pointPrice','6000')
    *{type('id=imagePath','/home/clara/下载/creative.jpg')}*
    *{type('id=imagePath','/0/0/112/cat.jpg')}*
    clickAndWait('id=onsale')
    assertTextPresent('积分商品一览')
    *{open('/pointgoods/${play.test.Fixtures.idCache.get("models.sales.PointGoods-PointGoods1")}')}*
    *{verifyTitle('查看积分商品')}*
    *{verifyTextPresent('测试积分商品1')}*
    *{verifyTextPresent('6000')}*
#{/selenium}


#{selenium '强制下架和同意上架'}
    #{include 'test/selenium/step/login.selenium' /}
    open('/pointgoods')
    clickAndWait('link=已上架')
    assertTextPresent('商品1')
    clickAndWait('link=强制下架')
    clickAndWait('link=已下架')
    assertTextPresent('商品1')
#{/selenium}


#{selenium '删除'}
    #{include 'test/selenium/step/login.selenium' /}
    open('/pointgoods')
    clickAndWait('link=已下架')
    assertTextPresent('商品3')
    click('id=del_${play.test.Fixtures.idCache.get("models.sales.PointGoods-PointGoods3")}')
    assertConfirmation('您确定要删除测试积分商品3吗?')
    verifyTextNotPresent('商品3');
#{/selenium}



