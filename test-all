#!/usr/bin/env ruby

require 'pathname'
current_dir = Pathname.new(File.dirname(__FILE__)).realpath

puts current_dir
failed_result = []
had_test_pass = false

app_dirs = [
            'website/www',
            'website/home',
            'traders/sales',
            'traders/order',
            'traders/home',
            'traders/admin',
            'cdn/image-server'
           ]


app_dirs.each do |dir|
  # Dir.chdir("#{current_dir}/#{dir}")
  cmd =<<END
        cd #{current_dir}/#{dir}
        play clean;
        play auto-test --deps
END
  IO.popen(cmd) { |output|
    output.each_line { |line|
      if line =~ /(FAILED|errors|ERROR)/
        failed_result << line
      else
        puts "#{line}"
        if line =~ /PASSED/
          had_test_pass = true
        end
      end
    }
  }
end

if had_test_pass
  exit(1)
end
